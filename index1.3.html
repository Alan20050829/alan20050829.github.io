<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <title>ç„¡æ•µå°æœ¬æœ¬</title>
    <style>
        :root {
            --ä¸»è¦è‰²: #E67E22;     /* æ˜äº®çš„æ©™è‰² */
            --è­¦ç¤ºè‰²: #C0392B;     /* æ·±ç´…è‰²ç”¨æ–¼è­¦ç¤º */
            --æˆåŠŸè‰²: #27AE60;     /* ç¶ è‰²ç”¨æ–¼æˆåŠŸï¼Œå¢åŠ å°æ¯” */
            --æ–‡å­—è‰²: #34495E;     /* æ·±è—ç°è‰²ç”¨æ–¼æ–‡å­— */
            --èƒŒæ™¯è‰²: #FEF5E7;     /* éå¸¸æ·ºçš„ç±³è‰²ç”¨æ–¼èƒŒæ™¯ */
            --å‡æ—¥è‰²: #FDEDEC;     /* æ·ºç²‰è‰²ç”¨æ–¼å‡æ—¥ */
            --page-bg: #FFFFFF;    /* ç´”ç™½è‰²ç”¨æ–¼é é¢èƒŒæ™¯ */
            --page-shadow: rgba(211, 84, 0, 0.2); /* æ©™è‰²é™°å½± */
            --hover-bg: #FDF2E9;   /* æ‡¸åœèƒŒæ™¯è‰² */
            --border-color: #F5B041; /* é‚Šæ¡†é¡è‰² */
            --task-bg: #FEF9E7;    /* ä»»å‹™èƒŒæ™¯è‰² */
        }
        * {
            -webkit-tap-highlight-color: transparent;
            touch-action: manipulation;
        }

        .è¦–åœ–å®¹å™¨ {
            position: relative;
            overflow: hidden;
            transition: transform 0.3s ease-in-out, opacity 0.3s ease-in-out;
        }

        .æœˆæ›†è¡¨æ ¼, .é€±è¦–åœ–è¡¨æ ¼ {
            transition: all 0.3s ease-in-out;
        }

        .å‘å·¦æ»‘å‡º {
            transform: translateX(-100%);
            opacity: 0;
        }

        .å‘å³æ»‘å‡º {
            transform: translateX(100%);
            opacity: 0;
        }

        .æ»‘å…¥ {
            transform: translateX(0);
            opacity: 1;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'å¾®è»Ÿæ­£é»‘é«”', sans-serif;
            margin: 0;
            padding: 0;
            min-height: 100vh;
            background: var(--èƒŒæ™¯è‰²);
            color: var(--æ–‡å­—è‰²);
            -webkit-text-size-adjust: 100%;
        }

        .ä¸»å®¹å™¨ {
            margin: 0 auto;
            padding: 12px;
            max-width: 100%;
            background: white;
            box-shadow: 0 2px 4px var(--page-shadow);
        }
        @media (min-width: 768px) {
            .ä¸»å®¹å™¨ {
                margin: 20px auto;
                padding: 20px;
                max-width: 1400px;
                border-radius: 12px;
            }
        }


        .book-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            pointer-events: none;
            background: none;
            opacity: 1;
            transition: opacity 0.5s ease-out;
        }

        .book {
            width: 80vw;
            height: 80vh;
            position: relative;
            transform-style: preserve-3d;
            transform: rotateY(-30deg);
            transition: all 1.5s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            animation: book-entry 1.5s ease-out forwards;
            max-width: 1200px;
            max-height: 800px;
        }

        @keyframes book-entry {
            0% {
                opacity: 0;
                transform: translate(0, 100px) rotateY(-180deg);
            }
            70% {
                opacity: 1;
                transform: translate(0, 0) rotateY(-30deg);
            }
            100% {
                opacity: 1;
                transform: rotateY(0deg);
            }
        }

        .page {
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            background: none;
            transform-origin: left center;
            backface-visibility: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: transform 1.5s;
        }

        .page-front {
            transform: rotateY(0deg);
            z-index: 2;
        }

        .page-back {
            transform: rotateY(180deg);
            z-index: 1;
        }

        .page-content {
            text-align: center;
            padding: 20px;
            font-size: 2.5em;
        }

        .æ§åˆ¶åˆ— {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
            margin-bottom: 1rem;
        }

        @media (min-width: 768px) {
            .æ§åˆ¶åˆ— {
                display: flex;
                gap: 10px;
                margin-bottom: 1.5rem;
            }
        }

        .è¦–åœ–æŒ‰éˆ• {
            padding: 12px;
            border: none;
            border-radius: 8px;
            background: var(--ä¸»è¦è‰²);
            color: white;
            font-size: 1rem;
            cursor: pointer;
            touch-action: manipulation;
            -webkit-tap-highlight-color: transparent;
            transition: background-color 0.2s;
        }


        .è¦–åœ–æŒ‰éˆ•.æ´»å‹• {
            background: var(--æˆåŠŸè‰²);
        }

        .æœˆæ›†æ¨™é ­ {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 1rem 0;
            padding: 0 0.5rem;
        }

        .æœˆæ›†æ¨™é ­ h2 {
            margin: 0;
            font-size: 1.2rem;
        }

        @media (min-width: 768px) {
            .æœˆæ›†æ¨™é ­ h2 {
                font-size: 1.8rem;
            }
        }

        .æœˆæ›†è¡¨æ ¼ {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 4px;
        }

        @media (min-width: 768px) {
            .æœˆæ›†è¡¨æ ¼ {
                gap: 8px;
            }
        }

        #å¹´ä»½é¸æ“‡å™¨, #æœˆä»½é¸æ“‡å™¨, .åˆ†éš”ç¬¦ {
            font-size: 1.8rem;
            font-weight: 600;
            font-family: inherit;
            text-align: center;
            text-align-last: center;
        }

        .å¹´ä»½é¸æ“‡å™¨, .æœˆä»½é¸æ“‡å™¨ {
            appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none;
            border: none;
            background: none;
            color: var(--ä¸»è¦è‰²);
            cursor: pointer;
            outline: none;
            transition: all 0.3s ease;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 1.8rem;
            font-weight: 600;
            position: relative;
            text-align: center !important;
            text-align-last: center !important;
        }

        .å¹´ä»½é¸æ“‡å™¨:hover, .æœˆä»½é¸æ“‡å™¨:hover {
            text-shadow: 3px 3px 6px rgba(230, 126, 34, 0.6);
            font-weight: 900;
            -webkit-text-stroke: 0.7px var(--ä¸»è¦è‰²);
            color: var(--ä¸»è¦è‰²);
        }

        .å¹´ä»½é¸æ“‡å™¨ option, .æœˆä»½é¸æ“‡å™¨ option {
            background-color: white;
            color: #333333;  /* æ”¹æˆæ·±ç°è¿‘é»‘è‰² */
            text-align: center !important;
            text-align-last: center !important;
            font-size: 1.4rem;  /* ç¸®å°å­—é«” */
            padding: 5px;
            margin: 0;
            border: none;
            font-weight: normal;  /* æ”¹å›æ­£å¸¸å­—é‡ */
            min-width: 100%;
            box-sizing: border-box;
        }

        .å¹´ä»½é¸æ“‡å™¨ option:hover, .æœˆä»½é¸æ“‡å™¨ option:hover {
            font-weight: 600;  /* é™ä½æ‡¸åœæ™‚çš„å­—é‡ */
            color: #333333;  /* ä¿æŒé»‘è‰² */
            transform: none !important;
            padding: 5px !important;
            margin: 0 !important;
        }

        .å°èˆªæŒ‰éˆ• {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--ä¸»è¦è‰²);
            padding: 0 1rem;
        }

        .æœˆæ›†è¡¨æ ¼, .é€±è¦–åœ–è¡¨æ ¼ {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 8px;
        }

        .æ—¥æœŸæ ¼ {
            padding: 0.5rem;
            min-height: 80px;
            border: 1px solid #eee;
            border-radius: 6px;
            background: white;
            font-size: 0.9rem;
            touch-action: manipulation;
        }

        @media (min-width: 768px) {
            .æ—¥æœŸæ ¼ {
                padding: 1rem;
                min-height: 150px;
                font-size: 1rem;
            }
        }


        .æ—¥æœŸæ ¼:hover {
            transform: translateY(-3px);
            box-shadow: 0 3px 6px rgba(210, 105, 30, 0.2);
        }

        .éæœ¬æœˆ {
            background: var(--èƒŒæ™¯è‰²);
            color: #999;
        }

        .å‡æ—¥ {
            background: var(--å‡æ—¥è‰²);
        }

        .ä»»å‹™é …ç›® {
            padding: 6px;
            margin: 4px 0;
            background: var(--task-bg);
            border-left: 3px solid var(--å„ªå…ˆç´šé¡è‰²);
            border-radius: 4px;
            font-size: 0.85rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            touch-action: manipulation;
        }

        @media (min-width: 768px) {
            .ä»»å‹™é …ç›® {
                padding: 8px;
                margin: 6px 0;
                font-size: 1rem;
            }
        }

        .ä»»å‹™å°è©±æ¡† {
            position: fixed;
            top: 0;
            left: 0;
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            z-index: 1001;
            opacity: 0;
            transform: scale(0.7);
            transition: opacity 0.2s ease-out, transform 0.2s ease-out;
        }
        .ä»»å‹™å°è©±æ¡†.é¡¯ç¤º {
            opacity: 1;
            transform: scale(1);
        }

        .å…¨å±€é®ç½© {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.3);
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.2s ease-out;
        }

        .å…¨å±€é®ç½©.é¡¯ç¤º {
            opacity: 1;
        }

        .å°è©±æ¡†èƒŒæ™¯ {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(230, 126, 34, 0.1);
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.3s ease-out;
        }

        .ä»»å‹™è¡¨å–® {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .ä»»å‹™è¡¨å–® input,
        .ä»»å‹™è¡¨å–® select {
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
        }


        .æŒ‰éˆ•çµ„ {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            margin-top: 12px;
        }

        .æŒ‰éˆ•çµ„ button {
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            touch-action: manipulation;
        }

        .æŒ‰éˆ•çµ„ button[type="submit"] {
            background: var(--ä¸»è¦è‰²);
            color: white;
        }

        .æŒ‰éˆ•çµ„ button[type="button"] {
            background: #eee;
        }

        .ç¯€æ—¥æ¨™ç¤º {
            font-size: 0.8em;
            color: var(--è­¦ç¤ºè‰²);
            margin-top: 4px;
        }

        .é€±è¦–åœ–è¡¨æ ¼ {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .é€±åˆ— {
            display: grid;
            grid-template-columns: 80px 1fr;
            gap: 8px;
        }

        @media (max-width: 767px) {
            .book-container {
                display: none;
            }
        }

        /* å¢åŠ è§¸æ§åé¥‹ */
        @media (hover: none) {
            .è¦–åœ–æŒ‰éˆ•:active,
            .ä»»å‹™é …ç›®:active,
            .æ—¥æœŸæ ¼:active {
                opacity: 0.7;
            }
        }

        /* å„ªåŒ–ç§»å‹•ç«¯æ»¾å‹•é«”é©— */
        .é€±è¦–åœ–è¡¨æ ¼,
        .æœˆæ›†è¡¨æ ¼ {
            -webkit-overflow-scrolling: touch;
            scroll-behavior: smooth;
        }

        .æ˜ŸæœŸæ¨™é ­ {
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            padding: 8px;
            background: var(--èƒŒæ™¯è‰²);
            border-radius: 8px;
        }

        .é€±æ—¥æœŸæ ¼ {
            min-height: 100px;
            padding: 1rem;
            border: 1px solid #eee;
            border-radius: 8px;
            background: white;
            transition: all 0.2s;
        }

        .é€±æ—¥æœŸæ ¼:hover {
            transform: translateY(-3px);
            box-shadow: 0 3px 6px rgba(210, 105, 30, 0.2);
        }

        .ä»»å‹™è¡¨å–® input[type="text"],
        .ä»»å‹™è¡¨å–® input[type="time"],
        .ä»»å‹™è¡¨å–® select {
            text-align: center;
            text-align-last: center;
        }

        .ä»»å‹™è¡¨å–® select option {
            text-align: center;
        }

        .æ—¥æœŸæ ¼.active,
        .é€±æ—¥æœŸæ ¼.active {
            background-color: var(--hover-bg);
            border: 1px solid var(--border-color);
        }

        .æ—¥æœŸæ ¼.active:hover,
        .é€±æ—¥æœŸæ ¼.active:hover {
            background-color: var(--task-bg);
        }
        select {
            -webkit-appearance: none;
            background: #fff url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%23E67E22' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M6 9l6 6 6-6'/%3E%3C/svg%3E") no-repeat right 8px center/16px 16px;
            padding-right: 24px;
        }
    </style>
</head>
<body>
    <!-- æ›¸æœ¬å‹•ç•«å®¹å™¨ -->
    <div class="book-container" id="bookAnimation">
        <div class="book">
            <div class="page page-front">
                <div class="page-content">
                    <h1>æ™ºèƒ½è¨ˆåŠƒæœ¬</h1>
                    <p>è¼•é¬†ç®¡ç†æ‚¨çš„æ¯ä¸€å¤©</p>
                </div>
            </div>
            <div class="page page-back">
                <div class="page-content">
                    <h2>é–‹å§‹æ‚¨çš„è¦åŠƒ</h2>
                </div>
            </div>
        </div>
    </div>

    <div class="ä¸»å®¹å™¨">
        <div class="æ§åˆ¶åˆ—">
            <button class="è¦–åœ–æŒ‰éˆ•" id="æœˆè¦–åœ–æŒ‰éˆ•" onclick="åˆ‡æ›è¦–åœ–('æœˆ')">ğŸ“… æœˆè¦–åœ–</button>
            <button class="è¦–åœ–æŒ‰éˆ•" id="é€±è¦–åœ–æŒ‰éˆ•" onclick="åˆ‡æ›è¦–åœ–('é€±')">ğŸ“† é€±è¦–åœ–</button>
            <input type="file" id="åŒ¯å…¥æª”æ¡ˆ" hidden>
            <button class="è¦–åœ–æŒ‰éˆ•" onclick="document.getElementById('åŒ¯å…¥æª”æ¡ˆ').click()">ğŸ“¥ åŒ¯å…¥æ•¸æ“š</button>
            <button class="è¦–åœ–æŒ‰éˆ•" onclick="åŒ¯å‡ºè³‡æ–™()">ğŸ“¤ åŒ¯å‡ºæ•¸æ“š</button>
        </div>

        <div class="æœˆæ›†æ¨™é ­">
            <button class="å°èˆªæŒ‰éˆ•" onclick="åˆ‡æ›æœŸé–“(-1)">â—€</button>
            <h2>
                <select id="å¹´ä»½é¸æ“‡å™¨" class="å¹´ä»½é¸æ“‡å™¨" onchange="æ›´æ”¹å¹´ä»½(this.value)">
                </select>
                <span class="åˆ†éš”ç¬¦">å¹´</span>
                <select id="æœˆä»½é¸æ“‡å™¨" class="å¹´ä»½é¸æ“‡å™¨" onchange="æ›´æ”¹æœˆä»½(this.value)">
                </select>
                <span class="åˆ†éš”ç¬¦">æœˆ</span>
            </h2>
            <button class="å°èˆªæŒ‰éˆ•" onclick="åˆ‡æ›æœŸé–“(1)">â–¶</button>
        </div>

        <div id="æ—¥æ›†å®¹å™¨"></div>
    </div>

    <script>
        // æ›¸æœ¬å‹•ç•«è…³æœ¬
        document.addEventListener('DOMContentLoaded', () => {
            setTimeout(() => {
                const bookAnimation = document.getElementById('bookAnimation');
                bookAnimation.style.opacity = '0';
                setTimeout(() => {
                    bookAnimation.style.display = 'none';
                }, 500);
            }, 2500);
        });

        // è³‡æ–™ç®¡ç†ç³»çµ±
        let ç•¶å‰è¦–åœ–æ¨¡å¼ = 'æœˆ';
        let ç•¶å‰æœˆä»½ = new Date().getMonth();
        let ç•¶å‰å¹´ä»½ = new Date().getFullYear();
        let ç•¶å‰é€±æ•¸ = Math.floor((new Date().getDate() - 1) / 7);
        let ä»»å‹™è³‡æ–™ = JSON.parse(localStorage.getItem('plan-data')) || [];
        let ç•¶å‰æ´»å‹•æ—¥æœŸæ ¼ = null;
        let touchStartX = 0;
        let touchEndX = 0;

        document.addEventListener('touchstart', e => {
            touchStartX = e.changedTouches[0].screenX;
        }, false);
        
        document.addEventListener('touchend', e => {
            touchEndX = e.changedTouches[0].screenX;
            handleSwipe();
        }, false);
        
        function handleSwipe() {
            const minSwipeDistance = 50;
            const swipeDistance = touchEndX - touchStartX;
            
            if (Math.abs(swipeDistance) > minSwipeDistance) {
                if (swipeDistance > 0) {
                    åˆ‡æ›æœŸé–“(-1); // å‘å³æ»‘å‹•ï¼Œé¡¯ç¤ºä¸Šä¸€å€‹æœˆ/é€±
                } else {
                    åˆ‡æ›æœŸé–“(1);  // å‘å·¦æ»‘å‹•ï¼Œé¡¯ç¤ºä¸‹ä¸€å€‹æœˆ/é€±
                }
            }
        }

        // å„ªåŒ–æ»¾å‹•æ•ˆèƒ½
        let isScrolling;
        window.addEventListener('scroll', () => {
            clearTimeout(isScrolling);
            document.body.classList.add('is-scrolling');
            
            isScrolling = setTimeout(() => {
                document.body.classList.remove('is-scrolling');
            }, 100);
        }, false);
        // åˆå§‹åŒ–å¹´ä»½é¸æ“‡å™¨
        function åˆå§‹åŒ–å¹´ä»½é¸æ“‡å™¨() {
            const é¸æ“‡å™¨ = document.getElementById('å¹´ä»½é¸æ“‡å™¨');
            const ç•¶å‰å¹´ä»½ = new Date().getFullYear();
            const èµ·å§‹å¹´ä»½ = ç•¶å‰å¹´ä»½ - 20;
            const çµæŸå¹´ä»½ = ç•¶å‰å¹´ä»½ + 20;
            
            é¸æ“‡å™¨.innerHTML = '';
            for (let å¹´ = èµ·å§‹å¹´ä»½; å¹´ <= çµæŸå¹´ä»½; å¹´++) {
                const é¸é … = document.createElement('option');
                é¸é ….value = å¹´;
                é¸é ….textContent = `${å¹´}`;
                if (å¹´ === ç•¶å‰å¹´ä»½) é¸é ….selected = true;
                é¸æ“‡å™¨.appendChild(é¸é …);
            }

            let æ»¾è¼ªè¨ˆæ•¸å™¨ = 0;
            é¸æ“‡å™¨.addEventListener('wheel', (äº‹ä»¶) => {
                äº‹ä»¶.preventDefault();
                æ»¾è¼ªè¨ˆæ•¸å™¨++;
                
                // æ¯2æ¬¡æ»¾è¼ªæ‰è§¸ç™¼ä¸€æ¬¡è®ŠåŒ–
                if (æ»¾è¼ªè¨ˆæ•¸å™¨ % 2 === 0) {
                    const æ–¹å‘ = äº‹ä»¶.deltaY > 0 ? 1 : -1;
                    const æ–°ç´¢å¼• = é¸æ“‡å™¨.selectedIndex + æ–¹å‘;
                    
                    if (æ–°ç´¢å¼• >= 0 && æ–°ç´¢å¼• < é¸æ“‡å™¨.options.length) {
                        é¸æ“‡å™¨.selectedIndex = æ–°ç´¢å¼•;
                        é¸æ“‡å™¨.dispatchEvent(new Event('change'));
                    }
                }
            });
        }

        function åˆå§‹åŒ–æœˆä»½é¸æ“‡å™¨() {
            const æœˆä»½é¸æ“‡å™¨ = document.getElementById('æœˆä»½é¸æ“‡å™¨');
            
            æœˆä»½é¸æ“‡å™¨.innerHTML = '';
            for (let æœˆ = 1; æœˆ <= 12; æœˆ++) {
                const é¸é … = document.createElement('option');
                é¸é ….value = æœˆ - 1;
                é¸é ….textContent = `${æœˆ}`;
                if (æœˆ - 1 === ç•¶å‰æœˆä»½) é¸é ….selected = true;
                æœˆä»½é¸æ“‡å™¨.appendChild(é¸é …);
            }
            
            let æ»¾è¼ªè¨ˆæ•¸å™¨ = 0;
            æœˆä»½é¸æ“‡å™¨.addEventListener('wheel', (äº‹ä»¶) => {
                äº‹ä»¶.preventDefault();
                æ»¾è¼ªè¨ˆæ•¸å™¨++;
                
                // æ¯2æ¬¡æ»¾è¼ªæ‰è§¸ç™¼ä¸€æ¬¡è®ŠåŒ–
                if (æ»¾è¼ªè¨ˆæ•¸å™¨ % 2 === 0) {
                    const æ–¹å‘ = äº‹ä»¶.deltaY > 0 ? 1 : -1;
                    let æ–°ç´¢å¼• = æœˆä»½é¸æ“‡å™¨.selectedIndex + æ–¹å‘;
                    
                    // å¯¦ç¾å¾ªç’°é‚è¼¯
                    if (æ–°ç´¢å¼• < 0) {
                        æ–°ç´¢å¼• = 11; // å¦‚æœå‘ä¸Šæ»¾å‹•è¶…éç¬¬ä¸€å€‹ï¼Œè·³åˆ°æœ€å¾Œä¸€å€‹ï¼ˆ12æœˆï¼‰
                    } else if (æ–°ç´¢å¼• >= æœˆä»½é¸æ“‡å™¨.options.length) {
                        æ–°ç´¢å¼• = 0; // å¦‚æœå‘ä¸‹æ»¾å‹•è¶…éæœ€å¾Œä¸€å€‹ï¼Œè·³åˆ°ç¬¬ä¸€å€‹ï¼ˆ1æœˆï¼‰
                    }
                    
                    æœˆä»½é¸æ“‡å™¨.selectedIndex = æ–°ç´¢å¼•;
                    æœˆä»½é¸æ“‡å™¨.dispatchEvent(new Event('change'));
                }
            });
        }

        function æ›´æ–°è¦–åœ–æŒ‰éˆ•ç‹€æ…‹() {
            document.getElementById('æœˆè¦–åœ–æŒ‰éˆ•').classList.toggle('æ´»å‹•', ç•¶å‰è¦–åœ–æ¨¡å¼ === 'æœˆ');
            document.getElementById('é€±è¦–åœ–æŒ‰éˆ•').classList.toggle('æ´»å‹•', ç•¶å‰è¦–åœ–æ¨¡å¼ === 'é€±');
        }

        function åˆ‡æ›è¦–åœ–(æ¨¡å¼) {
            ç•¶å‰è¦–åœ–æ¨¡å¼ = æ¨¡å¼;
            æ›´æ–°è¦–åœ–æŒ‰éˆ•ç‹€æ…‹();
            // é—œé–‰ä»»å‹™å°è©±æ¡†
            é—œé–‰ä»»å‹™å°è©±æ¡†();
            æ¸²æŸ“æ—¥æ›†();
        }

        function æ›´æ”¹å¹´ä»½(å¹´ä»½) {
            ç•¶å‰å¹´ä»½ = parseInt(å¹´ä»½);
            // é—œé–‰ä»»å‹™å°è©±æ¡†
            é—œé–‰ä»»å‹™å°è©±æ¡†();
            æ¸²æŸ“æ—¥æ›†();
        }

        function æ›´æ”¹æœˆä»½(æœˆä»½) {
            ç•¶å‰æœˆä»½ = parseInt(æœˆä»½);
            // é—œé–‰ä»»å‹™å°è©±æ¡†
            é—œé–‰ä»»å‹™å°è©±æ¡†();
            æ¸²æŸ“æ—¥æ›†();
        }

        function åˆ‡æ›æœŸé–“(å¢æ¸›å€¼) {
            const èˆŠå®¹å™¨ = document.querySelector('.è¦–åœ–å®¹å™¨');
            
            èˆŠå®¹å™¨.style.transition = 'transform 0.3s ease-in-out';
            èˆŠå®¹å™¨.style.transform = å¢æ¸›å€¼ > 0 ? 'translateX(-100%)' : 'translateX(100%)';
            èˆŠå®¹å™¨.style.opacity = '0';
            
            setTimeout(() => {
                if (ç•¶å‰è¦–åœ–æ¨¡å¼ === 'æœˆ') {
                    ç•¶å‰æœˆä»½ += å¢æ¸›å€¼;
                    if (ç•¶å‰æœˆä»½ < 0) {
                        ç•¶å‰æœˆä»½ = 11;
                        ç•¶å‰å¹´ä»½--;
                    } else if (ç•¶å‰æœˆä»½ > 11) {
                        ç•¶å‰æœˆä»½ = 0;
                        ç•¶å‰å¹´ä»½++;
                    }
                } else {
                    ç•¶å‰é€±æ•¸ += å¢æ¸›å€¼;
                    æ›´æ–°é€±è¦–åœ–æ—¥æœŸ();
                }
                
                // é—œé–‰ä»»å‹™å°è©±æ¡†
                é—œé–‰ä»»å‹™å°è©±æ¡†();
                
                æ¸²æŸ“æ—¥æ›†();
                const æ–°å®¹å™¨ = document.querySelector('.è¦–åœ–å®¹å™¨');
                æ–°å®¹å™¨.style.transition = 'none';
                æ–°å®¹å™¨.style.transform = å¢æ¸›å€¼ > 0 ? 'translateX(100%)' : 'translateX(-100%)';
                æ–°å®¹å™¨.style.opacity = '0';
                
                requestAnimationFrame(() => {
                    æ–°å®¹å™¨.style.transition = 'transform 0.3s ease-in-out, opacity 0.3s ease-in-out';
                    æ–°å®¹å™¨.style.transform = 'translateX(0)';
                    æ–°å®¹å™¨.style.opacity = '1';
                });
            }, 300);
        }

        function æ›´æ–°é€±è¦–åœ–æ—¥æœŸ() {
            const åŸºæº–æ—¥æœŸ = new Date(ç•¶å‰å¹´ä»½, ç•¶å‰æœˆä»½, 1 + (ç•¶å‰é€±æ•¸ * 7));
            const æœ¬æœˆå¤©æ•¸ = new Date(ç•¶å‰å¹´ä»½, ç•¶å‰æœˆä»½ + 1, 0).getDate();
            
            let æ–°æ—¥æœŸ = 1 + (ç•¶å‰é€±æ•¸ * 7);
            if (æ–°æ—¥æœŸ > æœ¬æœˆå¤©æ•¸) {
                ç•¶å‰é€±æ•¸ = 0;
                ç•¶å‰æœˆä»½++;
                if (ç•¶å‰æœˆä»½ > 11) {
                    ç•¶å‰æœˆä»½ = 0;
                    ç•¶å‰å¹´ä»½++;
                }
            } else if (æ–°æ—¥æœŸ < 1) {
                ç•¶å‰æœˆä»½--;
                if (ç•¶å‰æœˆä»½ < 0) {
                    ç•¶å‰æœˆä»½ = 11;
                    ç•¶å‰å¹´ä»½--;
                }
                const ä¸Šæœˆå¤©æ•¸ = new Date(ç•¶å‰å¹´ä»½, ç•¶å‰æœˆä»½ + 1, 0).getDate();
                ç•¶å‰é€±æ•¸ = Math.floor((ä¸Šæœˆå¤©æ•¸ - 1) / 7);
            }
        }

        function æ¸²æŸ“æ—¥æ›†() {
            const å®¹å™¨ = document.getElementById('æ—¥æ›†å®¹å™¨');
            const æ–°å®¹å™¨ = document.createElement('div');
            æ–°å®¹å™¨.className = 'è¦–åœ–å®¹å™¨';
            
            if (ç•¶å‰è¦–åœ–æ¨¡å¼ === 'æœˆ') {
                æ¸²æŸ“æœˆè¦–åœ–(æ–°å®¹å™¨);
            } else {
                æ¸²æŸ“é€±è¦–åœ–(æ–°å®¹å™¨);
            }

            å®¹å™¨.innerHTML = '';
            å®¹å™¨.appendChild(æ–°å®¹å™¨);
            
            document.getElementById('å¹´ä»½é¸æ“‡å™¨').value = ç•¶å‰å¹´ä»½;
            document.getElementById('æœˆä»½é¸æ“‡å™¨').value = ç•¶å‰æœˆä»½;
        }

        function æ¸²æŸ“æœˆè¦–åœ–(å®¹å™¨) {
            const è¡¨æ ¼ = document.createElement('div');
            è¡¨æ ¼.className = 'æœˆæ›†è¡¨æ ¼';

            ['æ—¥', 'ä¸€', 'äºŒ', 'ä¸‰', 'å››', 'äº”', 'å…­'].forEach(æ˜ŸæœŸ => {
                const æ¨™é ­ = document.createElement('div');
                æ¨™é ­.textContent = æ˜ŸæœŸ;
                æ¨™é ­.style.fontWeight = 'bold';
                æ¨™é ­.style.textAlign = 'center';
                æ¨™é ­.style.padding = '8px';
                è¡¨æ ¼.appendChild(æ¨™é ­);
            });

            const æœˆé¦– = new Date(ç•¶å‰å¹´ä»½, ç•¶å‰æœˆä»½, 1);
            const æœˆæœ« = new Date(ç•¶å‰å¹´ä»½, ç•¶å‰æœˆä»½ + 1, 0);

            let ç•¶å‰æ—¥æœŸ = new Date(æœˆé¦–);
            ç•¶å‰æ—¥æœŸ.setDate(æœˆé¦–.getDate() - æœˆé¦–.getDay());

            while (ç•¶å‰æ—¥æœŸ <= æœˆæœ« || ç•¶å‰æ—¥æœŸ.getDay() !== 0) {
                const cellDate = new Date(ç•¶å‰æ—¥æœŸ);
                const æ—¥æœŸæ ¼ = å‰µå»ºæ—¥æœŸæ ¼(cellDate);
                è¡¨æ ¼.appendChild(æ—¥æœŸæ ¼);
                ç•¶å‰æ—¥æœŸ.setDate(ç•¶å‰æ—¥æœŸ.getDate() + 1);
            }

            å®¹å™¨.appendChild(è¡¨æ ¼);
        }

        function å‰µå»ºæ—¥æœŸæ ¼(æ—¥æœŸ) {
            const æ—¥æœŸæ ¼ = document.createElement('div');
            const æ˜¯æœ¬æœˆ = æ—¥æœŸ.getMonth() === ç•¶å‰æœˆä»½;
            
            æ—¥æœŸæ ¼.className = 'æ—¥æœŸæ ¼';
            if (!æ˜¯æœ¬æœˆ) æ—¥æœŸæ ¼.classList.add('éæœ¬æœˆ');
            if (æ—¥æœŸ.getDay() === 0 || æ—¥æœŸ.getDay() === 6) æ—¥æœŸæ ¼.classList.add('å‡æ—¥');

            const æ—¥æœŸæ¨™é ­ = document.createElement('div');
            æ—¥æœŸæ¨™é ­.className = 'æ—¥æœŸæ¨™é ­';

            if (ç•¶å‰è¦–åœ–æ¨¡å¼ === 'é€±') {
                æ—¥æœŸæ¨™é ­.innerHTML = `
                    <h3>${æ—¥æœŸ.toLocaleDateString('zh-Hant', { month: 'long', day: 'numeric' })}</h3>
                    <small>${æ—¥æœŸ.toLocaleDateString('zh-Hant', { weekday: 'long' })}</small>
                    ${å–å¾—ç¯€æ—¥æ¨™ç¤º(æ—¥æœŸ)}
                `;
            } else {
                æ—¥æœŸæ¨™é ­.innerHTML = `
                    <h3>${æ—¥æœŸ.getDate()}</h3>
                    ${å–å¾—ç¯€æ—¥æ¨™ç¤º(æ—¥æœŸ)}
                `;
            }

            const ä»»å‹™å®¹å™¨ = document.createElement('div');
            ä»»å‹™å®¹å™¨.className = 'ä»»å‹™å®¹å™¨';
            ä»»å‹™å®¹å™¨.innerHTML = æ¸²æŸ“ç•¶æ—¥ä»»å‹™(æ—¥æœŸ);

            æ—¥æœŸæ ¼.appendChild(æ—¥æœŸæ¨™é ­);
            æ—¥æœŸæ ¼.appendChild(ä»»å‹™å®¹å™¨);

            æ—¥æœŸæ ¼.onclick = (äº‹ä»¶) => {
                if (äº‹ä»¶.target === æ—¥æœŸæ ¼ || äº‹ä»¶.target === ä»»å‹™å®¹å™¨ || äº‹ä»¶.target === æ—¥æœŸæ¨™é ­) {
                    é¡¯ç¤ºä»»å‹™å°è©±æ¡†(æ—¥æœŸ, null, äº‹ä»¶);
                }
            };

            return æ—¥æœŸæ ¼;
        }

        function æ¸²æŸ“é€±è¦–åœ–(å®¹å™¨) {
            const è¡¨æ ¼ = document.createElement('div');
            è¡¨æ ¼.className = 'é€±è¦–åœ–è¡¨æ ¼';

            const æ˜ŸæœŸåˆ—è¡¨ = ['æ—¥', 'ä¸€', 'äºŒ', 'ä¸‰', 'å››', 'äº”', 'å…­'];
            const åŸºæº–æ—¥æœŸ = new Date(ç•¶å‰å¹´ä»½, ç•¶å‰æœˆä»½, 1 + (ç•¶å‰é€±æ•¸ * 7));
            let ç•¶å‰æ—¥æœŸ = new Date(åŸºæº–æ—¥æœŸ);
            ç•¶å‰æ—¥æœŸ.setDate(ç•¶å‰æ—¥æœŸ.getDate() - ç•¶å‰æ—¥æœŸ.getDay());

            for (let i = 0; i < 7; i++) {
                const é€±åˆ— = document.createElement('div');
                é€±åˆ—.className = 'é€±åˆ—';

                const æ˜ŸæœŸæ¨™é ­ = document.createElement('div');
                æ˜ŸæœŸæ¨™é ­.className = 'æ˜ŸæœŸæ¨™é ­';
                æ˜ŸæœŸæ¨™é ­.textContent = `æ˜ŸæœŸ${æ˜ŸæœŸåˆ—è¡¨[i]}`;

                const æ—¥æœŸæ ¼ = å‰µå»ºé€±æ—¥æœŸæ ¼(new Date(ç•¶å‰æ—¥æœŸ));

                é€±åˆ—.appendChild(æ˜ŸæœŸæ¨™é ­);
                é€±åˆ—.appendChild(æ—¥æœŸæ ¼);
                è¡¨æ ¼.appendChild(é€±åˆ—);
                
                ç•¶å‰æ—¥æœŸ.setDate(ç•¶å‰æ—¥æœŸ.getDate() + 1);
            }

            å®¹å™¨.appendChild(è¡¨æ ¼);
        }

        function å‰µå»ºé€±æ—¥æœŸæ ¼(æ—¥æœŸ) {
            const æ—¥æœŸæ ¼ = document.createElement('div');
            æ—¥æœŸæ ¼.className = 'é€±æ—¥æœŸæ ¼';
            if (æ—¥æœŸ.getDay() === 0 || æ—¥æœŸ.getDay() === 6) {
                æ—¥æœŸæ ¼.classList.add('å‡æ—¥');
            }

            const æ—¥æœŸæ¨™é ­ = document.createElement('div');
            æ—¥æœŸæ¨™é ­.innerHTML = `
                <h3>${æ—¥æœŸ.toLocaleDateString('zh-Hant', { month: 'long', day: 'numeric' })}</h3>
                ${å–å¾—ç¯€æ—¥æ¨™ç¤º(æ—¥æœŸ)}
            `;

            const ä»»å‹™å®¹å™¨ = document.createElement('div');
            ä»»å‹™å®¹å™¨.className = 'ä»»å‹™å®¹å™¨';
            ä»»å‹™å®¹å™¨.innerHTML = æ¸²æŸ“ç•¶æ—¥ä»»å‹™(æ—¥æœŸ);

            æ—¥æœŸæ ¼.appendChild(æ—¥æœŸæ¨™é ­);
            æ—¥æœŸæ ¼.appendChild(ä»»å‹™å®¹å™¨);

            æ—¥æœŸæ ¼.addEventListener('click', (äº‹ä»¶) => {
                if (äº‹ä»¶.target === æ—¥æœŸæ ¼ || äº‹ä»¶.target === ä»»å‹™å®¹å™¨ || äº‹ä»¶.target === æ—¥æœŸæ¨™é ­) {
                    é¡¯ç¤ºä»»å‹™å°è©±æ¡†(æ—¥æœŸ, null, äº‹ä»¶);
                }
            });

            return æ—¥æœŸæ ¼;
        }

        function é¡¯ç¤ºä»»å‹™å°è©±æ¡†(æ—¥æœŸ, ä»»å‹™ = null, äº‹ä»¶) {
            // å…ˆæ¸…é™¤å·²å­˜åœ¨çš„å°è©±æ¡†å’Œé®ç½©
            é—œé–‰ä»»å‹™å°è©±æ¡†();

            // å‰µå»ºå…¨å±€é®ç½©
            const é®ç½© = document.createElement('div');
            é®ç½©.className = 'å…¨å±€é®ç½©';
            document.body.appendChild(é®ç½©);

            // ç‚ºé»æ“Šçš„æ—¥æœŸæ ¼æ·»åŠ åç°æ¨£å¼
            const é»æ“Šæ ¼ = äº‹ä»¶.currentTarget;
            é»æ“Šæ ¼.classList.add('active');

            // ç§»é™¤ä¹‹å‰æ´»å‹•æ—¥æœŸæ ¼çš„åç°æ¨£å¼
            if (ç•¶å‰æ´»å‹•æ—¥æœŸæ ¼ && ç•¶å‰æ´»å‹•æ—¥æœŸæ ¼ !== é»æ“Šæ ¼) {
                ç•¶å‰æ´»å‹•æ—¥æœŸæ ¼.classList.remove('active');
            }
            ç•¶å‰æ´»å‹•æ—¥æœŸæ ¼ = é»æ“Šæ ¼;

            const å°è©±æ¡† = document.createElement('div');
            å°è©±æ¡†.className = 'ä»»å‹™å°è©±æ¡†';
            
            const å¹´ = æ—¥æœŸ.getFullYear();
            const æœˆ = æ—¥æœŸ.getMonth();
            const æ—¥ = æ—¥æœŸ.getDate();

            å°è©±æ¡†.innerHTML = `
                <form class="ä»»å‹™è¡¨å–®" onsubmit="æäº¤ä»»å‹™è¡¨å–®(event, ${ä»»å‹™?.id || 'null'})">
                    <input type="hidden" name="å¹´" value="${å¹´}">
                    <input type="hidden" name="æœˆ" value="${æœˆ}">
                    <input type="hidden" name="æ—¥" value="${æ—¥}">
                    <input type="text" name="å…§å®¹" placeholder="ä»»å‹™å…§å®¹" value="${ä»»å‹™?.å…§å®¹ || ''}" required>
                    <input type="time" name="æ™‚é–“" 
                        value="${ä»»å‹™?.æ™‚é–“æˆ³ || ''}" 
                        min="00:00" 
                        max="23:59">
                    <select name="å„ªå…ˆç´š">
                        <option value="é«˜" ${ä»»å‹™?.å„ªå…ˆç´š === 'é«˜' ? 'selected' : ''}>é«˜å„ªå…ˆç´š</option>
                        <option value="ä¸­" ${ä»»å‹™?.å„ªå…ˆç´š === 'ä¸­' || !ä»»å‹™ ? 'selected' : ''}>ä¸­å„ªå…ˆç´š</option>
                        <option value="ä½" ${ä»»å‹™?.å„ªå…ˆç´š === 'ä½' ? 'selected' : ''}>ä½å„ªå…ˆç´š</option>
                    </select>
                    <div class="æŒ‰éˆ•çµ„">
                        <button type="button" onclick="é—œé–‰ä»»å‹™å°è©±æ¡†()">å–æ¶ˆ</button>
                        <button type="submit">ç¢ºå®š</button>
                    </div>
                </form>
            `;
            
            document.body.appendChild(å°è©±æ¡†);

            // å°è©±æ¡†ä½ç½®æ›´æ–°å‡½æ•¸
            let æ›´æ–°å°è©±æ¡†ä½ç½®è«‹æ±‚ID = null;
            let ä¸Šæ¬¡æ»¾å‹•æ™‚é–“ = 0;

            function æ›´æ–°å°è©±æ¡†ä½ç½®() {
                const ç•¶å‰æ™‚é–“ = Date.now();
                if (ç•¶å‰æ™‚é–“ - ä¸Šæ¬¡æ»¾å‹•æ™‚é–“ < 16) {
                    æ›´æ–°å°è©±æ¡†ä½ç½®è«‹æ±‚ID = requestAnimationFrame(æ›´æ–°å°è©±æ¡†ä½ç½®);
                    return;
                }
                ä¸Šæ¬¡æ»¾å‹•æ™‚é–“ = ç•¶å‰æ™‚é–“;

                const è¦–çª—é«˜åº¦ = window.innerHeight;
                const è¦–çª—å¯¬åº¦ = window.innerWidth;
                const å°è©±æ¡†é«˜åº¦ = å°è©±æ¡†.offsetHeight;
                const å°è©±æ¡†å¯¬åº¦ = å°è©±æ¡†.offsetWidth;

                const é ‚éƒ¨ä½ç½® = Math.max(20, Math.min(
                    è¦–çª—é«˜åº¦ - å°è©±æ¡†é«˜åº¦ - 20,
                    (è¦–çª—é«˜åº¦ - å°è©±æ¡†é«˜åº¦) / 2
                ));

                const å·¦å´ä½ç½® = Math.max(20, Math.min(
                    è¦–çª—å¯¬åº¦ - å°è©±æ¡†å¯¬åº¦ - 20,
                    (è¦–çª—å¯¬åº¦ - å°è©±æ¡†å¯¬åº¦) / 2
                ));

                å°è©±æ¡†.style.transform = `translate(${å·¦å´ä½ç½®}px, ${é ‚éƒ¨ä½ç½®}px) scale(1)`;
            }

            // åˆå§‹åŒ–ä½ç½®ä¸¦é¡¯ç¤ºå‹•ç•«
            requestAnimationFrame(() => {
                æ›´æ–°å°è©±æ¡†ä½ç½®();
                // å¼·åˆ¶é‡æ’å¾Œå†æ·»åŠ å‹•ç•«é¡
                å°è©±æ¡†.offsetHeight; // è§¸ç™¼é‡æ’
                å°è©±æ¡†.classList.add('é¡¯ç¤º');
                é®ç½©.classList.add('é¡¯ç¤º');
            });

            // ç›£è½æ»¾å‹•å’Œèª¿æ•´è¦–çª—å¤§å°äº‹ä»¶
            function æ»¾å‹•è™•ç†() {
                if (æ›´æ–°å°è©±æ¡†ä½ç½®è«‹æ±‚ID) {
                    cancelAnimationFrame(æ›´æ–°å°è©±æ¡†ä½ç½®è«‹æ±‚ID);
                }
                æ›´æ–°å°è©±æ¡†ä½ç½®è«‹æ±‚ID = requestAnimationFrame(æ›´æ–°å°è©±æ¡†ä½ç½®);
            }

            window.addEventListener('scroll', æ»¾å‹•è™•ç†, { passive: true });
            window.addEventListener('resize', æ»¾å‹•è™•ç†);

            // é»æ“Šé®ç½©é—œé–‰å°è©±æ¡†
            é®ç½©.addEventListener('click', (äº‹ä»¶) => {
                if (äº‹ä»¶.target === é®ç½©) {
                    é—œé–‰ä»»å‹™å°è©±æ¡†();
                }
            });

            // æ¸…ç†å‡½æ•¸
            function æ¸…ç†ç›£è½å™¨() {
                window.removeEventListener('scroll', æ»¾å‹•è™•ç†);
                window.removeEventListener('resize', æ»¾å‹•è™•ç†);
                if (æ›´æ–°å°è©±æ¡†ä½ç½®è«‹æ±‚ID) {
                    cancelAnimationFrame(æ›´æ–°å°è©±æ¡†ä½ç½®è«‹æ±‚ID);
                }
            }

            // åœ¨é—œé–‰å°è©±æ¡†æ™‚æ¸…ç†ç›£è½å™¨
            const åŸé—œé–‰æŒ‰éˆ• = å°è©±æ¡†.querySelector('button[type="button"]');
            åŸé—œé–‰æŒ‰éˆ•.addEventListener('click', æ¸…ç†ç›£è½å™¨);

            // åœ¨è¡¨å–®æäº¤æ™‚æ¸…ç†ç›£è½å™¨
            const è¡¨å–® = å°è©±æ¡†.querySelector('form');
            è¡¨å–®.addEventListener('submit', æ¸…ç†ç›£è½å™¨);

            // æ™‚é–“è¼¸å…¥è™•ç†
            const æ™‚é–“è¼¸å…¥ = å°è©±æ¡†.querySelector('input[type="time"]');
            æ™‚é–“è¼¸å…¥.addEventListener('input', function() {
                const æ™‚é–“å€¼ = this.value.split(':');
                const å°æ™‚ = parseInt(æ™‚é–“å€¼[0]);
                const åˆ†é˜ = æ™‚é–“å€¼[1];
                const æ ¼å¼åŒ–å°æ™‚ = å°æ™‚ % 24;
                this.value = `${æ ¼å¼åŒ–å°æ™‚.toString().padStart(2, '0')}:${åˆ†é˜}`;
            });
        }

        function é—œé–‰ä»»å‹™å°è©±æ¡†() {
            const å°è©±æ¡† = document.querySelector('.ä»»å‹™å°è©±æ¡†');
            const é®ç½© = document.querySelector('.å…¨å±€é®ç½©');
            
            if (å°è©±æ¡†) {
                // ç§»é™¤å‹•ç•«é¡è§¸ç™¼æ·¡å‡ºæ•ˆæœ
                å°è©±æ¡†.classList.remove('é¡¯ç¤º');
                é®ç½©?.classList.remove('é¡¯ç¤º');
                
                // ç­‰å¾…å‹•ç•«å®Œæˆå¾Œç§»é™¤å…ƒç´ 
                setTimeout(() => {
                    å°è©±æ¡†.remove();
                    é®ç½©?.remove();
                }, 200); // èˆ‡ CSS éæ¸¡æ™‚é–“ç›¸åŒ¹é…
            }

            // ç§»é™¤ç•¶å‰æ´»å‹•æ—¥æœŸæ ¼çš„åç°æ¨£å¼
            if (ç•¶å‰æ´»å‹•æ—¥æœŸæ ¼) {
                ç•¶å‰æ´»å‹•æ—¥æœŸæ ¼.classList.remove('active');
                ç•¶å‰æ´»å‹•æ—¥æœŸæ ¼ = null;
            }
        }

        function æäº¤ä»»å‹™è¡¨å–®(äº‹ä»¶, ä»»å‹™ID) {
            äº‹ä»¶.preventDefault();
            const è¡¨å–®æ•¸æ“š = new FormData(äº‹ä»¶.target);

            const å¹´ = parseInt(è¡¨å–®æ•¸æ“š.get('å¹´'));
            const æœˆ = parseInt(è¡¨å–®æ•¸æ“š.get('æœˆ'));
            const æ—¥ = parseInt(è¡¨å–®æ•¸æ“š.get('æ—¥'));
            const æ™‚é–“è¼¸å…¥ = è¡¨å–®æ•¸æ“š.get('æ™‚é–“');

            const æœ¬åœ°æ—¥æœŸå­—ç¬¦ä¸² = `${å¹´}-${(æœˆ + 1).toString().padStart(2, '0')}-${æ—¥.toString().padStart(2, '0')}`;

            let æ™‚é–“æˆ³ = '';
            if (æ™‚é–“è¼¸å…¥) {
                const [å°æ™‚, åˆ†é˜] = æ™‚é–“è¼¸å…¥.split(':');
                æ™‚é–“æˆ³ = `${å°æ™‚.padStart(2, '0')}:${åˆ†é˜.padStart(2, '0')}`;
            }

            const ä»»å‹™æ•¸æ“š = {
                id: ä»»å‹™ID || Date.now(),
                å…§å®¹: è¡¨å–®æ•¸æ“š.get('å…§å®¹'),
                æ—¥æœŸ: æœ¬åœ°æ—¥æœŸå­—ç¬¦ä¸²,
                æ™‚é–“æˆ³: æ™‚é–“æˆ³,
                å„ªå…ˆç´š: è¡¨å–®æ•¸æ“š.get('å„ªå…ˆç´š'),
                å®Œæˆ: false
            };

            if (ä»»å‹™ID) {
                ä»»å‹™è³‡æ–™ = ä»»å‹™è³‡æ–™.map(ä»»å‹™ => ä»»å‹™.id === ä»»å‹™ID ? ä»»å‹™æ•¸æ“š : ä»»å‹™);
            } else {
                ä»»å‹™è³‡æ–™.push(ä»»å‹™æ•¸æ“š);
            }
            
            å„²å­˜è³‡æ–™();
            é—œé–‰ä»»å‹™å°è©±æ¡†();
            æ¸²æŸ“æ—¥æ›†();
        }

        function æ¸²æŸ“ç•¶æ—¥ä»»å‹™(æ—¥æœŸ) {
            const å¹´ = æ—¥æœŸ.getFullYear();
            const æœˆ = (æ—¥æœŸ.getMonth() + 1).toString().padStart(2, '0');
            const æ—¥ = æ—¥æœŸ.getDate().toString().padStart(2, '0');
            const ç›®æ¨™æ—¥æœŸå­—ç¬¦ä¸² = `${å¹´}-${æœˆ}-${æ—¥}`;

            const ç•¶æ—¥ä»»å‹™ = ä»»å‹™è³‡æ–™
                .filter(ä»»å‹™ => ä»»å‹™.æ—¥æœŸ === ç›®æ¨™æ—¥æœŸå­—ç¬¦ä¸²)
                .sort((a, b) => {
                    if (a.æ™‚é–“æˆ³ === b.æ™‚é–“æˆ³) return a.id - b.id;
                    if (!a.æ™‚é–“æˆ³) return 1;
                    if (!b.æ™‚é–“æˆ³) return -1;
                    return a.æ™‚é–“æˆ³.localeCompare(b.æ™‚é–“æˆ³);
                });

            return ç•¶æ—¥ä»»å‹™.map(ä»»å‹™ => `
                <div class="ä»»å‹™é …ç›®" 
                     style="--å„ªå…ˆç´šé¡è‰²: ${å–å¾—å„ªå…ˆç´šé¡è‰²(ä»»å‹™.å„ªå…ˆç´š)}" 
                     data-task-id="${ä»»å‹™.id}"
                     onclick="ç·¨è¼¯ä»»å‹™(event, ${ä»»å‹™.id})">
                    <span>${ä»»å‹™.å…§å®¹}${ä»»å‹™.æ™‚é–“æˆ³ ? ` (${ä»»å‹™.æ™‚é–“æˆ³})` : ''}</span>
                    <div>
                        <input type="checkbox" 
                               ${ä»»å‹™.å®Œæˆ ? 'checked' : ''} 
                               onclick="åˆ‡æ›ä»»å‹™ç‹€æ…‹(event, ${ä»»å‹™.id})">
                        <button onclick="åˆªé™¤ä»»å‹™(event, ${ä»»å‹™.id})">ğŸ—‘ï¸</button>
                    </div>
                </div>
            `).join('');
        }

        function ç·¨è¼¯ä»»å‹™(äº‹ä»¶, ä»»å‹™ID) {
            äº‹ä»¶.stopPropagation();
            const ä»»å‹™ = ä»»å‹™è³‡æ–™.find(ä»»å‹™ => ä»»å‹™.id === ä»»å‹™ID);
            if (ä»»å‹™) {
                const [å¹´, æœˆ, æ—¥] = ä»»å‹™.æ—¥æœŸ.split('-').map(Number);
                const ä»»å‹™æ—¥æœŸ = new Date(å¹´, æœˆ - 1, æ—¥);
                é¡¯ç¤ºä»»å‹™å°è©±æ¡†(ä»»å‹™æ—¥æœŸ, ä»»å‹™);
            }
        }

        function åˆªé™¤ä»»å‹™(äº‹ä»¶, id) {
            äº‹ä»¶.stopPropagation();
            if (confirm('ç¢ºå®šè¦åˆªé™¤æ­¤ä»»å‹™ï¼Ÿ')) {
                ä»»å‹™è³‡æ–™ = ä»»å‹™è³‡æ–™.filter(ä»»å‹™ => ä»»å‹™.id !== id);
                å„²å­˜è³‡æ–™();
                æ¸²æŸ“æ—¥æ›†();
            }
        }

        function åˆ‡æ›ä»»å‹™ç‹€æ…‹(äº‹ä»¶, id) {
            äº‹ä»¶.stopPropagation();
            ä»»å‹™è³‡æ–™ = ä»»å‹™è³‡æ–™.map(ä»»å‹™ => 
                ä»»å‹™.id === id ? { ...ä»»å‹™, å®Œæˆ: !ä»»å‹™.å®Œæˆ } : ä»»å‹™
            );
            å„²å­˜è³‡æ–™();
            æ¸²æŸ“æ—¥æ›†();
        }

        function å–å¾—ç¯€æ—¥æ¨™ç¤º(æ—¥æœŸ) {
            const ç¯€æ—¥è¡¨ = {
                '2024': {
                    '1-1': 'å…ƒæ—¦',
                    '2-10': 'æ˜¥ç¯€',
                    '2-11': 'æ˜¥ç¯€',
                    '2-12': 'æ˜¥ç¯€',
                    '2-13': 'æ˜¥ç¯€',
                    '2-14': 'æ˜¥ç¯€',
                    '4-4': 'æ¸…æ˜ç¯€',
                    '5-1': 'å‹å‹•ç¯€',
                    '6-10': 'ç«¯åˆç¯€',
                    '9-17': 'ä¸­ç§‹ç¯€',
                    '10-10': 'åœ‹æ…¶æ—¥'
                }
            };
            const æœˆæ—¥ = `${æ—¥æœŸ.getMonth()+1}-${æ—¥æœŸ.getDate()}`;
            const ç¯€æ—¥ = ç¯€æ—¥è¡¨[æ—¥æœŸ.getFullYear()]?.[æœˆæ—¥];
            return ç¯€æ—¥ ? `<div class="ç¯€æ—¥æ¨™ç¤º">${ç¯€æ—¥}</div>` : '';
        }

        function å„²å­˜è³‡æ–™() {
            localStorage.setItem('plan-data', JSON.stringify(ä»»å‹™è³‡æ–™));
        }

        function åŒ¯å‡ºè³‡æ–™() {
            const è³‡æ–™å­—ä¸² = JSON.stringify(ä»»å‹™è³‡æ–™);
            const æª”æ¡ˆ = new Blob([è³‡æ–™å­—ä¸²], { type: 'application/json' });
            const ä¸‹è¼‰é€£çµ = document.createElement('a');
            ä¸‹è¼‰é€£çµ.href = URL.createObjectURL(æª”æ¡ˆ);
            ä¸‹è¼‰é€£çµ.download = `è¨ˆåŠƒå‚™ä»½_${new Date().toISOString().slice(0,10)}.json`;
            ä¸‹è¼‰é€£çµ.click();
        }

        function å–å¾—å„ªå…ˆç´šé¡è‰²(å„ªå…ˆç´š) {
            return {
                'é«˜': '#C0392B',  // æ·±ç´…è‰²
                'ä¸­': '#E67E22',  // æ©™è‰²
                'ä½': '#27AE60'   // ç¶ è‰²
            }[å„ªå…ˆç´š] || '#E67E22';
        }

        // åˆå§‹åŒ–è¨­å®š
        document.getElementById('åŒ¯å…¥æª”æ¡ˆ').addEventListener('change', function(e) {
            const æª”æ¡ˆ = e.target.files[0];
            const è®€å–å™¨ = new FileReader();
            è®€å–å™¨.onload = () => {
                try {
                    ä»»å‹™è³‡æ–™ = JSON.parse(è®€å–å™¨.result).map(ä»»å‹™ => {
                        if (typeof ä»»å‹™.æ™‚é–“ === 'number') {
                            const æ—¥æœŸå°è±¡ = new Date(ä»»å‹™.æ™‚é–“);
                            return {
                                ...ä»»å‹™,
                                æ—¥æœŸ: æ—¥æœŸå°è±¡.toISOString().split('T')[0],
                                æ™‚é–“: undefined
                            };
                        }
                        return ä»»å‹™;
                    });
                    å„²å­˜è³‡æ–™();
                    æ¸²æŸ“æ—¥æ›†();
                } catch {
                    alert('æª”æ¡ˆæ ¼å¼éŒ¯èª¤ï¼');
                }
            };
            è®€å–å™¨.readAsText(æª”æ¡ˆ);
        });

        // åˆå§‹åŒ–
        åˆå§‹åŒ–å¹´ä»½é¸æ“‡å™¨();
        åˆå§‹åŒ–æœˆä»½é¸æ“‡å™¨(); 
        æ›´æ–°è¦–åœ–æŒ‰éˆ•ç‹€æ…‹();
        æ¸²æŸ“æ—¥æ›†();
    </script>
</body>
</html>